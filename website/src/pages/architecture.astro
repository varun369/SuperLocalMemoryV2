---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/landing/Header.astro';
import Footer from '../components/landing/Footer.astro';
import { FadeIn } from '../components/ui/Motion';
import { Layers, Database, Server, Smartphone, Cpu, Lock, Code, Wifi, Activity, GitBranch, ShieldCheck, Brain } from 'lucide-react';

const layers = [
  { id: 9, name: "Visualization", desc: "Interactive Dashboard (v2.2.0)", icon: Activity },
  { id: 8, name: "Hybrid Search", desc: "Semantic + FTS5 + Graph", icon: Database },
  { id: 7, name: "Universal Access", desc: "MCP + Skills + CLI", icon: Smartphone },
  { id: 6, name: "MCP Integration", desc: "12 Tools, 6 Resources", icon: Code },
  { id: 5.5, name: "Adaptive Learning", desc: "Three-Layer Learning (v2.7)", icon: Brain },
  { id: 5, name: "Skills Layer", desc: "Universal Slash Commands", icon: Layers },
  { id: 4, name: "Pattern Learning", desc: "Bayesian Confidence Scoring", icon: GitBranch },
  { id: 3, name: "Knowledge Graph", desc: "Recursive Leiden Clustering", icon: Database },
  { id: 2, name: "Hierarchical Index", desc: "Tree Structure Navigation", icon: Layers },
  { id: 1, name: "Raw Storage", desc: "SQLite + FTS5 + TF-IDF", icon: Database },
];

---

<BaseLayout title="Architecture - SuperLocalMemory V2" description="Deep dive into the 10-layer architecture and component internals of the system.">
  <Header />
  
  <main class="pt-24 pb-24 min-h-screen bg-[var(--color-bg-main)]">
    <!-- Hero Section -->
    <section class="container-custom mb-20 text-center">
      <FadeIn client:load>
        <span class="text-[var(--color-primary)] font-mono text-sm tracking-wider uppercase mb-4 block">System Internals</span>
        <h1 class="text-5xl md:text-6xl font-bold mb-6">
          The <span class="text-gradient">System Architecture</span>
        </h1>
        <p class="text-xl text-[var(--color-text-muted)] max-w-2xl mx-auto">
          A purely local, high-performance architecture designed for zero-latency retrieval and absolute data sovereignty.
        </p>
      </FadeIn>
    </section>

    <!-- Architecture Diagram -->
    <section class="container-custom mb-32">
      <div class="grid lg:grid-cols-2 gap-16 items-start">
        
        <!-- Left: Interactive Stack -->
        <div class="relative space-y-4">
          <div class="absolute left-8 top-0 bottom-0 w-px bg-gradient-to-b from-[var(--color-primary)] via-[var(--color-accent)] to-transparent opacity-30"></div>
          
          {layers.map((layer, index) => (
            <FadeIn client:visible delay={index * 0.1} direction="left">
              <div class="relative pl-16 group cursor-default">
                <div class="absolute left-[30px] top-1/2 -translate-y-1/2 w-3 h-3 rounded-full bg-[var(--color-bg-main)] border border-[var(--color-primary)] group-hover:bg-[var(--color-primary)] transition-colors shadow-[0_0_10px_rgba(56,189,248,0.2)]"></div>
                
                <div class="glass-panel p-6 rounded-xl hover:border-[var(--color-primary)]/40 transition-all duration-300 group-hover:translate-x-2">
                  <div class="flex justify-between items-center mb-2">
                    <span class="text-xs font-mono text-[var(--color-primary)] opacity-70">LAYER {layer.id < 10 ? `0${layer.id}` : layer.id}</span>
                    <layer.icon className="w-5 h-5 text-white opacity-50 group-hover:opacity-100 transition-opacity" />
                  </div>
                  <h3 class="text-xl font-bold text-white mb-1 group-hover:text-[var(--color-primary)] transition-colors">{layer.name}</h3>
                  <p class="text-[var(--color-text-muted)] text-sm">{layer.desc}</p>
                </div>
              </div>
            </FadeIn>
          ))}
        </div>

        <!-- Right: Detail View (Visual) -->
        <div class="lg:sticky lg:top-32 space-y-8">
            <FadeIn client:visible delay={0.4}>
                <div class="aspect-square max-w-sm mx-auto lg:max-w-none rounded-full bg-gradient-to-tr from-[var(--color-primary)]/10 to-[var(--color-accent)]/10 flex items-center justify-center p-8 md:p-12 border border-white/5 relative overflow-hidden">
                    <div class="absolute inset-0 animate-spin-slow opacity-30">
                        <img src="/assets/knowledge_graph_visual_1771269746442.png" alt="Knowledge Graph" class="w-full h-full object-cover mix-blend-overlay" />
                    </div>
                    
                    <div class="text-center relative z-10">
                        <h4 class="text-2xl font-bold text-white mb-4">Data Flow</h4>
                        <p class="text-[var(--color-text-muted)]">
                            Data enters through the Agent Protocol (Layer 10), is processed by the Skills Layer (Layer 05), stored in Raw Storage (Layer 01), and then graph-processed (Layer 03) for relational context.
                        </p>
                    </div>
                </div>
            </FadeIn>

            <FadeIn client:visible delay={0.6}>
                <div class="glass-panel p-8 rounded-2xl border border-yellow-500/20">
                    <h4 class="text-lg font-bold text-yellow-500 mb-2 flex items-center gap-2">
                        <span class="w-5 h-5 flex items-center justify-center"><Lock /></span> Security Boundary
                    </h4>
                    <p class="text-[var(--color-text-muted)] text-sm">
                        Everything below Layer 10 is completely air-gapped. No data egress is possible physically at the architecture level.
                    </p>
                </div>
            </FadeIn>
        </div>

      </div>
    </section>


  </main>

  <Footer />
</BaseLayout>

